<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pong Game</title>
    <style>
      #game-status {
        position: absolute;
        top: 50%;
        left: 0;
        color: red;
        font-size: 3rem;
        text-align: center;
        width: 100%;
        transform: translateY(-50%);
        background-color: rgba(255, 255, 255, 0.7);
        padding: 30px 0;
      }
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div
      class="game-container"
      style="width: 1600; height: 800px; position: relative"
    >
      <canvas id="game-canvas" width="1600" height="800"></canvas>
      <div id="game-status" class="hidden"></div>
    </div>
    <div id="game-score"></div>
  </body>
  <script>
    var intervalHandle;
    areaHeight = 400;
    areaWidth = 1600;
    frameDelay = 10;
    ballX = areaWidth / 2;
    ballY = areaHeight / 2;
    ballSpeedX = -3;
    ballSpeedY = 3;
    ballAcceleration = 1.05;
    ballColor = [225, 255, 255];
    colorIndex = 0;
    colorDecreasing = true;
    colorSpeed = 3;
    ballWidth = 20;

    targetColor = "green";
    targetHitColor = "red";
    targetWidth = 10;

    paddleHeight = areaHeight;
    paddleWidth = 10;
    paddleColor = "pink";
    paddleY = [
      areaHeight / 2 - paddleHeight / 2,
      areaHeight / 2 - paddleHeight / 2,
    ];
    paddleFrontX = [
      targetWidth + paddleWidth, // paddle 1 front
      areaWidth - targetWidth - paddleWidth, // Paddle 2 front
    ];
    paddleSpeed = 5;
    paddleAcceleration = 1.05;
    paddleShrinkage = 0.95;
    minPaddleHeight = ballWidth * 5;

    hasTheBallPassedThePaddleThisRallyYet = [false, false];
    isUpPressed = [false, false];
    isDownPressed = [false, false];
    (() => {
      gameStatusElement = document.getElementById("game-status");
      gameScoreElement = document.getElementById("game-score");
      canv = document.getElementById("game-canvas");
      canv.height = areaHeight;
      canv.width = areaWidth;
      ctx = canv.getContext("2d");
      document.addEventListener("keydown", keyDown);
      document.addEventListener("keyup", keyUp);
      nextFrame();
      nextFrame();
    })();
    function startGame() {
      intervalHandle = setInterval(nextFrame, frameDelay);
      applesEaten = 0;
      printGameStatus("");
      printScore();
    }
    function pauseGame() {
      if (intervalHandle) {
        clearInterval(intervalHandle);
        intervalHandle = undefined;
      }
    }
    function gameOver() {
      pauseGame();
      printGameStatus("Game Over");
    }
    function printScore() {
      // gameScoreElement.innerText="Score: " + applesEaten;
    }
    function printGameStatus(status) {
      gameStatusElement.innerText = status;
      if (status.length > 0) {
        gameStatusElement.classList.remove("hidden");
      } else {
        gameStatusElement.classList.add("hidden");
      }
    }

    function nextFrame() {
      // clear canvas
      ctx.fillStyle = "black";
      ctx.fillRect(0, 0, canv.width, canv.height);

      // ball
      // Bounce off top
      if (ballY <= 0) {
        ballSpeedY = -1 * ballSpeedY;
      }
      // Bounce off bottom
      if (ballY >= areaHeight - ballWidth) {
        ballSpeedY = -1 * ballSpeedY;
      }

      // Bounce off paddle 1
      if (ballX <= paddleFrontX[0]) {
        if (hasTheBallPassedThePaddleThisRallyYet[0]) {
          // Bounce off the top or bottom of paddle
          ballSpeedY = -1 * ballSpeedY;
        } else if (
          ballY <= paddleY[0] + paddleHeight && // Top of ball is above bottom of paddle
          ballY + ballWidth >= paddleY[0] // Bottom of ball is below top of paddle
        ) {
          ballSpeedX = -1 * ballSpeedX;
          ballSpeedX *= ballAcceleration;
          // ballSpeedY *= ballAcceleration;
          paddleSpeed *= paddleAcceleration;
          paddleHeight = Math.max(
            minPaddleHeight,
            paddleHeight * paddleShrinkage
          );
        }
        hasTheBallPassedThePaddleThisRallyYet[0] = true;
      } else {
        hasTheBallPassedThePaddleThisRallyYet[0] = false;
      }

      // Bounce off paddle 2
      if (ballX + ballWidth >= paddleFrontX[1]) {
        if (hasTheBallPassedThePaddleThisRallyYet[1]) {
          // Bounce off the top or bottom of paddle
          ballSpeedY = -1 * ballSpeedY;
        } else if (
          ballY <= paddleY[1] + paddleHeight && // Top of ball is above bottom of paddle
          ballY + ballWidth >= paddleY[1] // Bottom of ball is below top of paddle
        ) {
          ballSpeedX = -1 * ballSpeedX;
          ballSpeedX *= ballAcceleration;
          // ballSpeedY *= ballAcceleration;
          paddleSpeed *= paddleAcceleration;
          paddleHeight = Math.max(
            minPaddleHeight,
            paddleHeight * paddleShrinkage
          );
        }
        hasTheBallPassedThePaddleThisRallyYet[1] = true;
      } else {
        hasTheBallPassedThePaddleThisRallyYet[1] = false;
      }

      ballX = ballX + ballSpeedX;
      ballY = ballY + ballSpeedY;
      // paint ball
      if (colorDecreasing) {
        ballColor[colorIndex] -= colorSpeed;
        if (ballColor[colorIndex] <= 0) {
          colorDecreasing = false;
          ballColor[colorIndex] = 0;
        }
      } else {
        ballColor[colorIndex] += colorSpeed;
        if (ballColor[colorIndex] >= 255) {
          ballColor[colorIndex] = 255;
          colorIndex = (colorIndex + 1) % 3;
          colorDecreasing = true;
        }
      }
      ctx.fillStyle = `rgb(${ballColor[0]}, ${ballColor[1]}, ${ballColor[2]})`;
      ctx.fillRect(ballX, ballY, ballWidth, ballWidth);

      // Target Area 1
      ctx.fillStyle = targetColor;
      ctx.fillRect(0, 0, targetWidth, areaHeight);
      // Target Area 2
      ctx.fillStyle = targetColor;
      ctx.fillRect(areaWidth - targetWidth, 0, areaWidth, areaHeight);

      // Ball target detection
      if (ballX <= targetWidth) {
        ctx.fillStyle = targetHitColor;
        ctx.fillRect(0, 0, targetWidth, areaHeight);
      }
      if (ballX >= areaWidth - targetWidth) {
        ctx.fillStyle = targetHitColor;
        ctx.fillRect(areaWidth - targetWidth, 0, areaWidth, areaHeight);
      }
      // Paddle 1
      if (isUpPressed[0]) {
        paddleY[0] -= paddleSpeed;
      }
      if (isDownPressed[0]) {
        paddleY[0] += paddleSpeed;
      }
      ctx.fillStyle = paddleColor;
      ctx.fillRect(targetWidth, paddleY[0], paddleWidth, paddleHeight);
      // Paddle 2
      if (isUpPressed[1]) {
        paddleY[1] -= paddleSpeed;
      }
      if (isDownPressed[1]) {
        paddleY[1] += paddleSpeed;
      }
      ctx.fillRect(
        areaWidth - targetWidth - paddleWidth,
        paddleY[1],
        paddleWidth,
        paddleHeight
      );

      // playerX+=xVel;
      // playerY+=yVel;

      // if(playerX >= areaSquares) {
      //   playerX = 0;
      // }
      // if(playerX < 0) {
      //   playerX = areaSquares - 1;
      // }
      // if(playerY >= areaSquares) {
      //   playerY = 0;
      // }
      // if(playerY < 0) {
      //   playerY = areaSquares - 1;
      // }

      // ctx.fillStyle="black";
      // ctx.fillRect(0,0,canv.width, canv.height);

      // ctx.fillStyle=snakeColor;
      // for(var i=0; i<snake.length; ++i) {
      //   ctx.fillRect(
      //     snake[i].x * squareWidth + squareBorderWidth,
      //     snake[i].y * squareWidth + squareBorderWidth,
      //     squareWidth - (squareBorderWidth * 2),
      //     squareWidth - (squareBorderWidth * 2)
      //   )
      //   if(snake[i].x===playerX && snake[i].y === playerY) {
      //     // We just lost, reset the snake
      //     snakeLength = 5;
      //     if (intervalHandle) {
      //       gameOver();
      //     }
      //   }
      // }
      // snake.push({x: playerX, y: playerY});
      // while(snake.length>snakeLength) {
      //   snake.shift();
      // }

      // if(appleX===playerX && appleY === playerY) {
      //   // We ate an apple!
      //   snakeLength++;
      //   applesEaten++;
      //   printScore();
      //   newApple();
      // }
      // ctx.fillStyle=appleColor;
      // ctx.fillRect(
      //   appleX * areaSquares,
      //   appleY* areaSquares,
      //   squareWidth,
      //   squareWidth,
      // )
    }
    function keyDown(ev) {
      if (ev.key === " ") {
        if (intervalHandle) {
          pauseGame();
        } else {
          startGame();
        }
      } else {
        if (!intervalHandle) {
          startGame();
        }
      }
      switch (ev.key) {
        case "ArrowUp":
          isUpPressed[1] = true;
          break;

        case "ArrowDown":
          isDownPressed[1] = true;
          break;

        case "w":
          isUpPressed[0] = true;
          break;

        case "s":
          isDownPressed[0] = true;
          break;
      }
    }
    function keyUp(ev) {
      switch (ev.key) {
        case "ArrowUp":
          isUpPressed[1] = false;
          break;

        case "ArrowDown":
          isDownPressed[1] = false;
          break;

        case "w":
          isUpPressed[0] = false;
          break;

        case "s":
          isDownPressed[0] = false;
          break;
      }
    }
  </script>
</html>
